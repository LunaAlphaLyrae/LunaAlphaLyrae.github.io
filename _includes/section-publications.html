<article id="publications">
  <h2 class="major">Publications</h2>
  {% assign pubs = site.data.publications.items | sort: 'year' | reverse %}
  {% if pubs and pubs.size > 0 %}
    {% assign years = pubs | map: 'year' | uniq %}
    {% for y in years %}
      <h3>{{ y }}</h3>
      <ul class="publications">
        {% for p in pubs %}
          {% if p.year == y %}
            <li class="publication-item">
              <div class="pub-title">{{ p.title }}</div>
              <div class="pub-authors">{{ p.authors }}</div>
              <div class="pub-venue">{{ p.venue }}</div>
              <div class="pub-links">
                {% if p.doi %}<a href="https://doi.org/{{ p.doi }}" target="_blank" rel="noopener">DOI</a>{% endif %}
                {% if p.arxiv_url %} | <a href="{{ p.arxiv_url }}" target="_blank" rel="noopener">arXiv</a>{% endif %}
                {% if p.ads_url %} | <a href="{{ p.ads_url }}" target="_blank" rel="noopener">ADS</a>{% endif %}
                {% if p.pdf_url %} | <a href="{{ p.pdf_url }}" target="_blank" rel="noopener">PDF</a>{% endif %}
                {% if p.code_url %} | <a href="{{ p.code_url }}" target="_blank" rel="noopener">Code</a>{% endif %}
                {% if p.bibtex %} | <button class="button" data-bibtex="{{ p.bibtex | escape }}" onclick="copyBibtex(this)">Copy BibTeX</button>{% endif %}
              </div>
            </li>
          {% endif %}
        {% endfor %}
      </ul>
    {% endfor %}
  {% else %}
    <p>Add your publications in <code>_data/publications.yml</code>.</p>
  {% endif %}
  <script>
    function copyBibtex(btn) {
      const text = btn.getAttribute('data-bibtex');
      if (!navigator.clipboard) {
        const area = document.createElement('textarea');
        area.value = text;
        document.body.appendChild(area);
        area.select();
        try { document.execCommand('copy'); btn.textContent = 'Copied'; }
        catch(e) { btn.textContent = 'Failed'; }
        finally { document.body.removeChild(area); }
        return;
      }
      navigator.clipboard.writeText(text).then(() => btn.textContent = 'Copied').catch(() => btn.textContent = 'Failed');
      setTimeout(() => btn.textContent = 'Copy BibTeX', 1600);
    }
  </script>
</article>
